<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="ActiveJ 5.4.3 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="ActiveJ 5.4.3 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">ActiveJ | ByteBufï¼ŒJava NIO ByteBuffersçš„è½»é‡çº§æ›¿ä»£å“ | ActiveJ 5.4.3</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/zh/misc/bytebuf"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ | ByteBufï¼ŒJava NIO ByteBuffersçš„è½»é‡çº§æ›¿ä»£å“ | ActiveJ 5.4.3"><meta data-react-helmet="true" name="description" content="Java NIO ByteBuffersçš„è½»é‡çº§æ›¿ä»£å“ï¼ŒGCå ç”¨ç‡æä½ã€‚"><meta data-react-helmet="true" property="og:description" content="Java NIO ByteBuffersçš„è½»é‡çº§æ›¿ä»£å“ï¼ŒGCå ç”¨ç‡æä½ã€‚"><meta data-react-helmet="true" name="keywords" content="å­—èŠ‚ç¼“å†²åŒº,å­—èŠ‚ç¼“å†²åŒº,java nio,å­—èŠ‚ç¼“å†²åŒºæ›¿ä»£å“,çˆªå“‡,JAVAæ¡†æ¶"><link data-react-helmet="true" rel="shortcut icon" href="/zh/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/zh/misc/bytebuf"><link data-react-helmet="true" rel="alternate" href="https://activej.io/misc/bytebuf" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/misc/bytebuf" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/misc/bytebuf" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/misc/bytebuf" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/zh/assets/js/runtime~main.0e1b47c8.js" as="script">
<link rel="preload" href="/zh/assets/js/main.9ec85a8c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh/overview">æ–‡ä»¶</a><a class="navbar__item navbar__link" href="/zh/tutorials/getting-started">æ•™ç¨‹</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh/blog">åšå®¢</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ğŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ğŸŒ</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/overview">æ¦‚è¿°</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å¼‚æ­¥I/O</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">é´å­</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ³¨å…¥</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ç¼–ç åŸºå› </a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ä¸²è¡Œå™¨</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ä¸“ä¸šäººå‘˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">é›‡å‘˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">æ‚é¡¹</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/misc/bytebuf">å­—èŠ‚æ•°</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">åœ¨è¿™ä¸€é¡µ</button></div><div class="theme-doc-markdown markdown"><header><h1>å­—èŠ‚æ•°</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="æ¦‚è¿°">æ¦‚è¿°<a aria-hidden="true" class="hash-link" href="#æ¦‚è¿°" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>ActiveJçš„ç›®çš„æ˜¯ä½¿é«˜æ•ˆè€Œé«˜çº§çš„I/Oã€‚ è¿™éœ€è¦å¤§é‡ä½¿ç”¨ç”¨æˆ·ç©ºé—´çš„ å­—èŠ‚ç¼“å†²åŒºã€‚ ä¸å¹¸çš„æ˜¯ï¼Œä¼ ç»Ÿçš„Java <code>ByteBuffer</code>ï¼Œç»™GCå¸¦æ¥äº†æ²‰é‡çš„è´Ÿæ‹…ã€‚</p><p>ä¸ºäº†å‡å°‘GCå¼€é”€ï¼ŒActiveJå¼•å…¥äº†è‡ªå·±çš„GCå‹å¥½å’Œè½»é‡çº§çš„ <a href="#bytebuf"><code>ByteBufs</code></a>ï¼Œå®ƒå¯ä»¥ä¸ <a href="#bytebufpool"><code>ByteBufPool</code></a>é‡å¤ä½¿ç”¨ã€‚</p><p>æ­¤å¤–ï¼Œå¸¸è§çš„I/Oæ¨¡å¼æ˜¯å°† <code>ByteBuffer</code>sä½œä¸ºä¸€ä¸ªé˜Ÿåˆ—ã€‚I/Oæ“ä½œäº§ç”Ÿæ•°æ®ï¼Œè€Œåº”ç”¨ç¨‹åºæ¶ˆè€—æ•°æ®ï¼Œåä¹‹äº¦ç„¶ã€‚ <code>ByteBuf</code>sä¹Ÿæ˜¯ä¸ºäº†ä¿ƒè¿›è¿™ç§æ¨¡å¼ï¼Œæä¾›ä¸“é—¨çš„ <a href="#bytebufs"><code>ByteBufs</code></a> ç±»ï¼Œåœ¨å¤šä¸ª <code>ByteBuf</code>sä¸­è¿›è¡Œç±»ä¼¼é˜Ÿåˆ—çš„æ“ä½œã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å­—èŠ‚buf">å­—èŠ‚Buf<a aria-hidden="true" class="hash-link" href="#å­—èŠ‚buf" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>ä¸ Java NIO <code>ByteBuffer</code> ç›¸æ¯”, ä¸€ä¸ªéå¸¸è½»é‡å’Œæ•ˆç‡æé«˜çš„å®ç°æ–¹æ³•ã€‚ æ²¡æœ‰ç›´æ¥çš„ç¼“å†²å™¨ï¼Œ ï¼Œè¿™å°±ç®€åŒ–å’Œæ”¹å–„äº† <a href="https://github.com/activej/activej/blob/v5.4.3/core-bytebuf/src/main/java/io/activej/bytebuf/ByteBuf.java" target="_blank"><code>ByteBuf</code></a> æ€§èƒ½ã€‚</p><p><code>ByteBuf</code> ç±»ä¼¼äºFIFOå­—èŠ‚é˜Ÿåˆ—ï¼Œæœ‰ä¸¤ä¸ªä½ç½®ï¼š <em>head</em> å’Œ <em>tail</em>ã€‚ å½“ä½ å‘ <code>ByteBuf</code>å†™æ•°æ®æ—¶ï¼Œå®ƒçš„ <em>å°¾éƒ¨</em> ï¼ŒæŒ‰å†™çš„å­—èŠ‚æ•°å¢åŠ ã€‚ åŒæ ·ï¼Œå½“ä½ ä» <code>ByteBuf</code>ï¼Œ å®ƒçš„ <em>head</em> è¯»å–çš„å­—èŠ‚æ•°ä¼šå¢åŠ ã€‚</p><p>æ‚¨åªèƒ½ä» <code>Bytebuf</code> è¯»å–å­—èŠ‚ã€‚å…¶ <em>å°¾éƒ¨</em> å¤§äº <em>å¤´</em>ã€‚ åŒæ ·ï¼Œä½ å¯ä»¥å‘ <code>ByteBuf</code> å†™å­—èŠ‚ï¼Œç›´åˆ° <em>å°¾éƒ¨</em> ä¸è¶…è¿‡åŒ…è£¹çš„æ•°ç»„çš„é•¿åº¦ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸éœ€è¦ <code>ByteBuffer.flip()</code> æ“ä½œã€‚</p><p><code>ByteBuf</code> æ”¯æŒå¹¶å‘è¿›ç¨‹ï¼šå½“ä¸€ä¸ªè¿›ç¨‹å‘ <code>ByteBuf</code>å†™ä¸€äº›æ•°æ®æ—¶ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ è¯»å–å®ƒã€‚</p><p>è¦åˆ›å»ºä¸€ä¸ª <code>ByteBuf</code> ï¼Œä½ å¯ä»¥å°†ä½ çš„å­—èŠ‚æ•°ç»„åŒ…è£¹åˆ° <code>ByteBuf</code> ï¼Œæˆ–è€…ä» <code>ByteBufPool</code>ä¸­åˆ†é…å®ƒã€‚</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ª <code>ByteBuf</code>* è€Œæ²¡æœ‰ä» <code>ByteBufPool</code>ä¸­åˆ†é…å®ƒï¼Œè°ƒç”¨ <code>ByteBuf.recycle()</code> å°†ä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œè¿™æ ·çš„ <code>ByteBuf</code>sä¼šè¢«GCç®€å•åœ°æ”¶é›†èµ·æ¥ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="å­—èŠ‚bufpool">å­—èŠ‚BufPool<a aria-hidden="true" class="hash-link" href="#å­—èŠ‚bufpool" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p><code>ByteBufPool</code> å…è®¸é‡å¤ä½¿ç”¨ <code>ByteBuf</code>sï¼Œä»è€Œå‡å°‘GCè´Ÿè½½ã€‚ ä¸ºäº†ä½¿ <a href="https://github.com/activej/activej/blob/v5.4.3/core-bytebuf/src/main/java/io/activej/bytebuf/ByteBufPool.java" target="_blank"><code>ByteBufPool</code></a> ä½¿ç”¨æ›´æ–¹ä¾¿ï¼Œæœ‰è°ƒè¯•å’Œç›‘æ§å·¥å…·ï¼Œç”¨äºåˆ†é… <code>ByteBuf</code>ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„å †æ ˆç—•è¿¹ã€‚</p><p>è¦ä»æ± ä¸­è·å¾—ä¸€ä¸ª <code>ByteBuf</code> ï¼Œä½¿ç”¨ <code>ByteBufPool.allocate(int size)</code>ã€‚ å°†åˆ†é…ä¸€ä¸ªå››èˆäº”å…¥åˆ°ä¸‹ä¸€ä¸ª æœ€æ¥è¿‘çš„2æ¬¡æ–¹å¤§å°çš„ <code>ByteBuf</code> ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœ <em>å¤§å°</em> æ˜¯29ï¼Œå°†åˆ†é…ä¸€ä¸ª32å­—èŠ‚çš„ <code>ByteBuf</code>ï¼‰ã€‚</p><p>è¦å°† <code>ByteBuf</code> è¿”å›åˆ° <code>ByteBufPool</code>ï¼Œä½¿ç”¨ <code>ByteBuf.recycle()</code>ã€‚ ä¸C/Cç­‰è¯­è¨€ç›¸æ¯”ï¼Œä¸éœ€è¦ ï¼Œå›æ”¶ <code>ByteBuf</code>s - åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¼šè¢«GCæ”¶é›†ã€‚</p><p>ä¸ºäº†ä½¿ä¸€åˆ‡ä¿æŒä¸€è‡´ï¼ŒActiveJä¾èµ–äº &quot;æ‰€æœ‰æƒ &quot;çš„æ¦‚å¿µï¼ˆå°±åƒRustè¯­è¨€ä¸€æ ·ï¼‰--åœ¨åˆ†é…ä¹‹åï¼Œ ï¼Œç»„ä»¶å°†ä¸€ä¸ª <em>byteBuf</em> ï¼Œä»ä¸€ä¸ªä¼ åˆ°å¦ä¸€ä¸ªï¼Œç›´åˆ°æœ€åçš„ &quot;æ‰€æœ‰è€… &quot;å°†å…¶å›æ”¶åˆ° <code>ByteBufPool</code>ã€‚</p><p>ä½ å¯ä»¥åœ¨è¿™é‡Œæ¢ç´¢ <code>ByteBufPool</code> ç”¨ä¾‹ <a href="#bytebuf-pool-example">ã€‚</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²<a aria-hidden="true" class="hash-link" href="#å­—ç¬¦ä¸²" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p><strong><a href="https://github.com/activej/activej/blob/v5.4.3/core-bytebuf/src/main/java/io/activej/bytebuf/ByteBufs.java" target="_blank"><code>ByteBufs</code></a></strong> ç±»æä¾›äº†å¯¹å¤šä¸ª <code>ByteBuf</code>çš„æœ‰æ•ˆç®¡ç†ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªç”±å‡ ä¸ª ByteBufsç»„æˆçš„å…·æœ‰FIFOè§„åˆ™çš„ä¼˜åŒ–é˜Ÿåˆ—ã€‚</p><p>ä½ å¯ä»¥åœ¨è¿™é‡Œæ¢ç´¢ <code>ByteBufs</code> ç”¨ä¾‹ <a href="#bytebufs-example">ã€‚</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å®ç”¨ç±»">å®ç”¨ç±»<a aria-hidden="true" class="hash-link" href="#å®ç”¨ç±»" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>ByteBufæ¨¡å—è¿˜åŒ…å« <a href="https://github.com/activej/activej/blob/v5.4.3/core-bytebuf/src/main/java/io/activej/bytebuf/util" target="_blank"><code>utility classes</code></a> æ¥ç®¡ç†å’Œè°ƒæ•´åº•å±‚å­—èŠ‚ç¼“å†²åŒºçš„å¤§å°ï¼Œ <code>String</code> è½¬æ¢ï¼Œç­‰ç­‰ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å®ä¾‹">å®ä¾‹<a aria-hidden="true" class="hash-link" href="#å®ä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><ul><li><p><a href="#bytebuf-example">ByteBuf ç¤ºä¾‹</a> - è¡¨ç¤ºä¸€äº›åŸºæœ¬çš„ <code>ByteBuf</code> çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ã€‚</p><ul><li>å°†æ•°æ®åŒ…è£¹åœ¨ <code>ByteBuf</code> ï¼Œç”¨äºå†™/è¯»ã€‚</li><li>å°†æ•°æ®ä¸­çš„ç‰¹å®šéƒ¨åˆ†åˆ‡æˆç‰‡çŠ¶ã€‚</li><li>è½¬æ¢ã€‚</li></ul></li><li><p><a href="#bytebuf-pool-example">ByteBuf Pool ç¤ºä¾‹</a> - è¡¨ç¤ºå¦‚ä½•ä½¿ç”¨ <code>ByteBufPool</code>ã€‚</p></li><li><p><a href="#bytebufs-example">ByteBufs ç¤ºä¾‹</a> - æ˜¾ç¤ºäº†å¦‚ä½•åˆ›å»ºå’Œå¤„ç† <code>ByteBuf</code>çš„é˜Ÿåˆ—ã€‚</p></li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>è¦è¿è¡Œä¾‹å­ï¼Œä½ éœ€è¦ä»GitHubå…‹éš†ActiveJ</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W shell"><pre tabindex="0" class="prism-code language-shell codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/activej/activej</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>å¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªMavené¡¹ç›®å¯¼å…¥ã€‚ æŸ¥çœ‹æ ‡ç­¾ <strong>v5.4.3</strong>ã€‚ åœ¨è¿è¡Œè¿™äº›ä¾‹å­ä¹‹å‰ï¼Œå…ˆå»ºç«‹é¡¹ç›®ã€‚ è¿™äº›ä¾‹å­ä½äº <code>activej/examples/core/bytebuf</code></p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="bytebufä¾‹å­">ByteBufä¾‹å­<a aria-hidden="true" class="hash-link" href="#bytebufä¾‹å­" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>å¦‚æœä½ è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œä½ ä¼šæ”¶åˆ°ä»¥ä¸‹è¾“å‡ºã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[0, 1, 2, 3, 4, 5]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ä½ å¥½</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">åˆ‡ç‰‡çš„`ByteBuf`é˜µåˆ—ã€‚[1, 2, 3]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ä»`ByteBuffer`è½¬æ¢çš„`ByteBuf`æ•°ç»„ã€‚[1, 2, 3]</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><ul><li>å‰å…­è¡Œæ˜¯å°†ä¸€ä¸ªå­—èŠ‚æ•°ç»„åŒ…è£¹åˆ°ä¸€ä¸ª <code>ByteBuf</code> åŒ…è£…å™¨ä¸­è¿›è¡Œè¯»å–ï¼Œç„¶åæ‰“å°çš„ç»“æœã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">byte[] data = new byte[]{0, 1, 2, 3, 4, 5};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf byteBuf = ByteBuf.wrapForReading(data);</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><ul><li>è¿™ä¸€è¡Œ <code>[0, 1, 2, 3, 4, 5]</code> ï¼Œæ˜¯å°†ä¸€ä¸ªç©ºçš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸º <code>ByteBuf</code> ï¼Œå¹¶å°†å®ƒä»¬åŒ…è£…èµ·æ¥ï¼Œä»¥ä¾¿ ã€‚ ç„¶åï¼Œåœ¨ <code>while</code> å¾ªç¯çš„å¸®åŠ©ä¸‹ï¼Œ <code>ByteBuf</code> è¢«å¡«å……äº†å­—èŠ‚ã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">byte[] data = new byte[6];</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf byteBuf = ByteBuf.wrapForWriting(data);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">byte value = 0;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">while (byteBuf.canWrite()) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  byteBuf.writeByte(value++);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><ul><li>&quot;Hello &quot;è¡Œé¦–å…ˆä»å­—ç¬¦ä¸²è½¬æ¢ä¸º <code>ByteBuf</code> ï¼Œå¹¶åŒ…è£¹èµ·æ¥ç”¨äºè¯»å–ï¼Œç„¶ååœ¨ <code>byteBuf.asString()</code>çš„å¸®åŠ©ä¸‹è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ç”¨äºè¾“å‡ºã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">String message = &quot;Hello&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf byteBuf = ByteBuf.wrapForReading(message.getBytes(UTF_8));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String unWrappedMessage = byteBuf.asString(UTF_8);</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><ul><li>æœ€åä¸¤ä¸ªè¾“å‡ºä»£è¡¨äº† <code>ByteBuf</code>çš„ä¸€äº›å…¶ä»–å¯èƒ½æ€§ï¼Œæ¯”å¦‚è¯´åˆ‡ç‰‡ã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">byte[] data = new byte[]{0, 1, 2, 3, 4, 5};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf byteBuf = ByteBuf.wrap(data, 0, data.length);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf slice = byteBuf.slice(1, 3);</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>å¹¶å°†é»˜è®¤çš„ <code>ByteBuffer</code> è½¬æ¢ä¸º <code>ByteBuf</code>ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf byteBuf = ByteBuf.wrap(new byte[20], 0, 0);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuffer buffer = byteBuf.toWriteByteBuffer();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">buffer.put((byte) 1);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">buffer.put((byte) 2);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">buffer.put((byte) 3);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">byteBuf.ofWriteByteBuffer(buffer);</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.4.3/examples/core/bytebuf/src/main/java/ByteBufExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="bytebufæ± çš„ä¾‹å­">ByteBufæ± çš„ä¾‹å­<a aria-hidden="true" class="hash-link" href="#bytebufæ± çš„ä¾‹å­" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>å¦‚æœä½ è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œä½ ä¼šæ”¶åˆ°ä»¥ä¸‹è¾“å‡ºã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">åˆ†é…çš„ByteBufé˜µåˆ—çš„é•¿åº¦ï¼š128</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">å›æ”¶å‰æ± ä¸­çš„ByteBufsçš„æ•°é‡ã€‚0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">å›æ”¶åæ± ä¸­çš„ByteBufsçš„æ•°é‡ã€‚1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">æ± ä¸­çš„ByteBufsæ•°é‡ã€‚0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBufçš„å¤§å°ï¼š4</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">å†™å®Œ3ä¸ªå­—èŠ‚åByteBufçš„å‰©ä½™å­—èŠ‚ã€‚1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ä¸€ä¸ªæ–°çš„ByteBufçš„å‰©ä½™å­—èŠ‚æ•°ï¼š5</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[0, 1, 2, 3, 4, 5]</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®æ–½æƒ…å†µã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public final class ByteBufPoolExample {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /* Setting ByteBufPool minSize and maxSize properties here for illustrative purposes.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Otherwise, ByteBufs with size less than 32 would not be placed into pool</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   */</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  static {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.setProperty(&quot;ByteBufPool.minSize&quot;, &quot;1&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void allocatingBufs() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Allocating a ByteBuf of 100 bytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf byteBuf = ByteBufPool.allocate(100);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Allocated ByteBuf has an array with size equal to next power of 2, hence 128</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Length of array of allocated ByteBuf: &quot; + byteBuf.writeRemaining());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Pool has 0 ByteBufs right now</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Number of ByteBufs in pool before recycling: &quot; + ByteBufPool.getStats().getPoolItems());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Recycling ByteBuf to put it back to pool</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    byteBuf.recycle();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Now pool consists of 1 ByteBuf that is the one we just recycled</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Number of ByteBufs in pool after recycling: &quot; + ByteBufPool.getStats().getPoolItems());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Trying to allocate another ByteBuf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf anotherByteBuf = ByteBufPool.allocate(123);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Pool is now empty as the only ByteBuf in pool has just been taken from the pool</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Number of ByteBufs in pool: &quot; + ByteBufPool.getStats().getPoolItems());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void ensuringWriteRemaining() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf byteBuf = ByteBufPool.allocate(3);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Size is equal to power of 2 that is larger than 3, hence 4</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Size of ByteBuf: &quot; + byteBuf.writeRemaining());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    byteBuf.write(new byte[]{0, 1, 2});</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // After writing 3 bytes into ByteBuf we have only 1 spare byte in ByteBuf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Remaining bytes of ByteBuf after 3 bytes have been written: &quot; + byteBuf.writeRemaining());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // We need to write 3 more bytes, so we have to ensure that there are 3 spare bytes in ByteBuf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // and if there are not - create new ByteBuf with enough room for 3 bytes (old ByteBuf will get recycled)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf newByteBuf = ByteBufPool.ensureWriteRemaining(byteBuf, 3);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Amount of ByteBufs in pool:&quot; + ByteBufPool.getStats().getPoolItems());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // As we need to write 3 more bytes, we need a ByteBuf that can hold 6 bytes.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // The next power of 2 is 8, so considering 3 bytes that have already been written, new ByteBuf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // can store (8-3=5) more bytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Remaining bytes of a new ByteBuf: &quot; + newByteBuf.writeRemaining());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Recycling a new ByteBuf (remember, the old one has already been recycled)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    newByteBuf.recycle();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void appendingBufs() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf bufOne = ByteBuf.wrapForReading(new byte[]{0, 1, 2});</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf bufTwo = ByteBuf.wrapForReading(new byte[]{3, 4, 5});</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf appendedBuf = ByteBufPool.append(bufOne, bufTwo);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Appended ByteBuf consists of two ByteBufs, you don&#x27;t have to worry about allocating ByteBuf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // with enough capacity or how to properly copy bytes, ByteBufPool will handle it for you</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(Arrays.toString(appendedBuf.asArray()));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public static void main(String[] args) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    allocatingBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensuringWriteRemaining();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    appendingBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.4.3/examples/core/bytebuf/src/main/java/ByteBufPoolExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="bytebufsç¤ºä¾‹">ByteBufsç¤ºä¾‹<a aria-hidden="true" class="hash-link" href="#bytebufsç¤ºä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>å¦‚æœä½ è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œä½ ä¼šæ”¶åˆ°ä»¥ä¸‹è¾“å‡ºã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bufs:2 bytes:7</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bufå–è‡ªbufsã€‚[0, 1, 2, 3]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bufå–è‡ªbufsã€‚[3, 4, 5, 6, 7, 8]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1, 2, 3, 4]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[5, 6, 7, 8]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;ByteBufs&#x27;æ˜¯å¦ä¸ºç©ºï¼Ÿ çœŸ</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>ç¬¬ä¸€è¡Œè¡¨ç¤ºæˆ‘ä»¬åœ¨æ·»åŠ äº†ä¸¤ä¸ªbufsä¹‹åçš„é˜Ÿåˆ—ï¼š <code>[0, 1, 2, 3]</code> å’Œ <code>[3, 4, 5]</code> ä¸ <code>BUFS.add()</code> æ–¹æ³•ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUFS.add(ByteBuf.wrapForReading(new byte[]{0, 1, 2, 3}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUFS.add(ByteBuf.wrapForReading(new byte[]{3, 4, 5}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// bufs consist of 2 Bufs at this moment</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>ç„¶ååº”ç”¨æ–¹æ³• <code>BUFS.take()</code> ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªæ·»åŠ çš„bufï¼Œå³ <code>[0, 1, 2, 3]</code>ã€‚ ä¸‹ä¸€è¡Œè¡¨ç¤ºä¸¤ä¸ªæ“ä½œçš„ç»“æœï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„ <code>[6, 7, 8]</code> bufï¼Œç„¶ååº”ç”¨ <code>BUFS.takeRemaining()</code> ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºæ‰€æœ‰å‰©ä½™çš„bufsã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Adding one more ByteBuf to bufs</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUFS.add(ByteBuf.wrapForReading(new byte[]{6, 7, 8}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ByteBuf takenBuf = BUFS.takeRemaining();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Taken ByteBuf is combined of every ByteBuf that were in bufs</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>æ³¨æ„ <code>take()</code> å’Œ <code>poll()</code> <strong>ByteBufs</strong> æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ã€‚ å½“ä½¿ç”¨ <code>take()</code>ï¼Œä½ å¿…é¡»ç¡®ä¿é˜Ÿåˆ—ä¸­è‡³å°‘æœ‰ä¸€ä¸ª <em>ByteBuf</em> ï¼Œå¦åˆ™ ä½¿ç”¨ <code>poll()</code> ï¼Œå®ƒå¯èƒ½è¿”å› <code>null</code>ã€‚</p></div></div><p>æœ€åï¼Œæœ€åä¸‰è¡Œä»£è¡¨ä»¥ä¸‹æ“ä½œã€‚</p><ul><li>åˆ›å»ºä¸¤ä¸ªbufsï¼š <code>[1, 2, 3, 4]</code> å’Œ <code>[5, 6, 7, 8]</code>ã€‚</li><li>å°†é˜Ÿåˆ—ä¸­çš„å†…å®¹æ’ç»™æ¶ˆè´¹è€…ï¼Œç”±æ¶ˆè´¹è€…æ‰“å°å‡ºbufsã€‚</li><li>ç„¶åæˆ‘ä»¬æ£€æŸ¥è¯¥é˜Ÿåˆ—ç°åœ¨æ˜¯å¦ä¸ºç©ºã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import io.activej.bytebuf.ByteBuf;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import io.activej.bytebuf.ByteBufs;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Arrays;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public final class ByteBufsExample {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final ByteBufs BUFS = new ByteBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void addingToBufs() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //[START REGION_1]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BUFS.add(ByteBuf.wrapForReading(new byte[]{0, 1, 2, 3}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BUFS.add(ByteBuf.wrapForReading(new byte[]{3, 4, 5}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // bufs consist of 2 Bufs at this moment</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //[END REGION_1]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(BUFS);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void takingBufOutOfBufs() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf takenBuf = BUFS.take();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Buf that is taken is the one that was put in bufs first</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Buf taken from bufs: &quot; + Arrays.toString(takenBuf.asArray()));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static void takingEverythingOutOfBufs() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //[START REGION_2]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Adding one more ByteBuf to bufs</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BUFS.add(ByteBuf.wrapForReading(new byte[]{6, 7, 8}));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ByteBuf takenBuf = BUFS.takeRemaining();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Taken ByteBuf is combined of every ByteBuf that were in bufs</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //[END REGION_2]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Buf taken from bufs: &quot; + Arrays.toString(takenBuf.asArray()));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(&quot;Is &#x27;ByteBufs&#x27; empty? &quot; + BUFS.isEmpty());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public static void main(String[] args) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    addingToBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    takingBufOutOfBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    takingEverythingOutOfBufs();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.4.3/examples/core/bytebuf/src/main/java/ByteBufsExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£é¡µé¢å¯¼èˆª"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/fs/examples"><div class="pagination-nav__sublabel">ä¸Šä¸€ç¯‡</div><div class="pagination-nav__label">Â« <!-- -->å®ä¾‹</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ¦‚è¿°" class="table-of-contents__link toc-highlight">æ¦‚è¿°</a></li><li><a href="#å­—èŠ‚buf" class="table-of-contents__link toc-highlight">å­—èŠ‚Buf</a></li><li><a href="#å­—èŠ‚bufpool" class="table-of-contents__link toc-highlight">å­—èŠ‚BufPool</a></li><li><a href="#å­—ç¬¦ä¸²" class="table-of-contents__link toc-highlight">å­—ç¬¦ä¸²</a></li><li><a href="#å®ç”¨ç±»" class="table-of-contents__link toc-highlight">å®ç”¨ç±»</a></li><li><a href="#å®ä¾‹" class="table-of-contents__link toc-highlight">å®ä¾‹</a><ul><li><a href="#bytebufä¾‹å­" class="table-of-contents__link toc-highlight">ByteBufä¾‹å­</a></li><li><a href="#bytebufæ± çš„ä¾‹å­" class="table-of-contents__link toc-highlight">ByteBufæ± çš„ä¾‹å­</a></li><li><a href="#bytebufsç¤ºä¾‹" class="table-of-contents__link toc-highlight">ByteBufsç¤ºä¾‹</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021å¹´ ActiveJ LLC.ä¿ç•™æ‰€æœ‰æƒåˆ©</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.0e1b47c8.js"></script>
<script src="/zh/assets/js/main.9ec85a8c.js"></script>
</body>
</html>