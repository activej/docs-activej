<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="ActiveJ 5.0 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="ActiveJ 5.0 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">ActiveJ | Promise, Java Promiseç”¨äºå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæ›¿ä»£Java Futures | ActiveJ 5.0</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/zh/async-io/promise"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ | Promise, Java Promiseç”¨äºå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæ›¿ä»£Java Futures | ActiveJ 5.0"><meta data-react-helmet="true" name="description" content="å—Node.jså¯å‘çš„Promiseç”¨äºå¼‚æ­¥Javaç¼–ç¨‹ã€‚ JavaæœŸè´§çš„æ›¿ä»£å“--æœ‰æ–¹ä¾¿çš„APIï¼Œé€Ÿåº¦å¿«7å€"><meta data-react-helmet="true" property="og:description" content="å—Node.jså¯å‘çš„Promiseç”¨äºå¼‚æ­¥Javaç¼–ç¨‹ã€‚ JavaæœŸè´§çš„æ›¿ä»£å“--æœ‰æ–¹ä¾¿çš„APIï¼Œé€Ÿåº¦å¿«7å€"><meta data-react-helmet="true" name="keywords" content="æ‰¿è¯º,nodejs,node js,java,å¼‚æ­¥ç¼–ç¨‹,éåŒæ­¥çš„,JAVAæ¡†æ¶,java æœŸè´§,å¯å®Œæˆçš„æœªæ¥,å®Œæˆé˜¶æ®µ,javaæ‰¿è¯º"><link data-react-helmet="true" rel="shortcut icon" href="/zh/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/zh/async-io/promise"><link data-react-helmet="true" rel="alternate" href="https://activej.io/async-io/promise" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/async-io/promise" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/async-io/promise" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/async-io/promise" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/zh/assets/js/runtime~main.e188156b.js" as="script">
<link rel="preload" href="/zh/assets/js/main.5fe716eb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh/overview">æ–‡ä»¶</a><a class="navbar__item navbar__link" href="/zh/tutorials/getting-started">æ•™ç¨‹</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh/blog">åšå®¢</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ğŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ğŸŒ</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/overview">æ¦‚è¿°</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">å¼‚æ­¥I/O</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/async-io/eventloop">äº‹ä»¶é“¾æ¥</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/async-io/promise">æ‰¿è¯º</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/async-io/csp">CSP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/async-io/datastream">æ•°æ®æµ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/async-io/net">Net</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">é´å­</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ³¨å…¥</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ç¼–ç åŸºå› </a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ä¸²è¡Œå™¨</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ä¸“ä¸šäººå‘˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">é›‡å‘˜</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ‚é¡¹</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">åœ¨è¿™ä¸€é¡µ</button></div><div class="theme-doc-markdown markdown"><header><h1>æ‰¿è¯º</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="æ¦‚è¿°">æ¦‚è¿°<a aria-hidden="true" class="hash-link" href="#æ¦‚è¿°" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>è®¸è¯ºæ˜¯ActiveJå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„ä¸»è¦æ„ä»¶ï¼Œå¯ä»¥ä¸Java Futuresç›¸æ¯”è¾ƒã€‚ <code>Promise</code> ä»£è¡¨ä¸€ä¸ªå°šæœªå®Œæˆçš„æ“ä½œçš„ç»“æœã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="ç‰¹ç‚¹">ç‰¹ç‚¹<a aria-hidden="true" class="hash-link" href="#ç‰¹ç‚¹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><ul><li>ä¸Java Futuresä¸åŒï¼Œ <strong>Promises</strong> ï¼Œè¢«è®¾è®¡ä¸ºåœ¨ä¸€ä¸ªå•ä¸€çš„äº‹ä»¶å¾ªç¯çº¿ç¨‹ä¸­å·¥ä½œã€‚</li><li><strong>æ‰¿è¯º</strong> æ˜¯éå¸¸è½»çš„ <a href="#optimization-features"></a></li><li>æ²¡æœ‰å¤šçº¿ç¨‹çš„å¼€é”€</li><li>æ¯ç§’å¯å¤„ç†æ•°ç™¾ä¸‡æ¬¡å‘¼å«</li><li>ç”¨äºç»„åˆå¤šä¸ªæ‰¿è¯ºçš„å¼ºå¤§çš„API</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="åˆ›é€ è¯ºè¨€">åˆ›é€ è¯ºè¨€<a aria-hidden="true" class="hash-link" href="#åˆ›é€ è¯ºè¨€" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>æˆ‘ä»¬ä¸»è¦å¯ä»¥ç”¨åŸºæœ¬çš„é™æ€æ–¹æ³•åˆ›å»º <code>Promise</code>ã€‚</p><ul><li><code>of(T value)</code> - åˆ›å»ºä¸€ä¸ªæˆåŠŸå®Œæˆçš„æ‰¿è¯ºï¼Œå¦‚ <code>CompletableFuture.completedFuture()</code>.</li><li><code>ofException(Exception e)</code> - åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å®Œæˆçš„æ‰¿è¯ºã€‚</li><li><code>complete()</code> - åˆ›å»ºä¸€ä¸ªæˆåŠŸå®Œæˆçš„ <code>Promise&lt;Void&gt;</code>ï¼Œæ˜¯ <code>Promise.of(null)</code>çš„å¿«æ·æ–¹å¼ã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; firstNumber = Promise.of(10);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise.of(&quot;Hello World&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise.ofException(new Exception(&quot;Something went wrong&quot;) )ã€‚</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="é“¾å¼æ‰¿è¯º">é“¾å¼æ‰¿è¯º<a aria-hidden="true" class="hash-link" href="#é“¾å¼æ‰¿è¯º" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>Promiseå°†åœ¨æŸä¸ªæœªæŒ‡å®šçš„æ—¶é—´æˆåŠŸæˆ–å¤±è´¥ï¼Œä½ éœ€è¦å°†åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹æ‰§è¡Œçš„æ–¹æ³•è¿é”èµ·æ¥ã€‚</p><ul><li><code>then(FunctionEx&lt;T, Promise&lt;U&gt;&gt;)</code> - è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œè¯¥Promiseæ˜¯é€šè¿‡å°†åŸPromiseçš„ç»“æœæ˜ å°„åˆ°å¦ä¸€ä¸ªPromiseè€Œå¾—åˆ°çš„ã€‚ å¦‚æœåŸæ¥çš„æ‰¿è¯ºè¢«ä¾‹å¤–åœ°å®Œæˆäº†ï¼Œå°†ä¸åº”ç”¨æ˜ å°„åŠŸèƒ½ã€‚ ç±»ä¼¼äºJavaçš„ <code>CompletionStage.thenCompose()</code>ã€‚ ç”¨äºå°†ä¸€ä¸ªæ‰¿è¯ºçš„ç»“æœæ˜ å°„åˆ°å¦ä¸€ä¸ªæ‰¿è¯ºã€‚</li><li><code>then(SupplierEx&lt;&gt;)</code> - è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œè¯¥Promiseæ˜¯é€šè¿‡è°ƒç”¨ä¸€ä¸ªæä¾›çš„ä¾›åº”å•†çš„æ–°Promiseè·å¾—çš„ã€‚ å¦‚æœæœ€åˆçš„æ‰¿è¯ºè¢«ä¾‹å¤–åœ°å®Œæˆï¼Œå°±ä¸ä¼šæœ‰ä¾›åº”å•†è¢«è°ƒç”¨ã€‚ å¦‚æœä½ å¯ä»¥å¿½ç•¥åŸå§‹æ‰¿è¯ºçš„ç»“æœï¼Œè¯·ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚</li><li><code>map(FunctionEx&lt;T, U&gt;)</code> - è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œè¯¥Promiseæ˜¯é€šè¿‡å°†åŸå§‹promiseçš„ç»“æœæ˜ å°„åˆ°ä¸€äº›å…¶ä»–çš„å€¼è€Œå¾—åˆ°ã€‚ å¦‚æœåŸæ¥çš„æ‰¿è¯ºè¢«ä¾‹å¤–åœ°å®Œæˆäº†ï¼Œå°†ä¸åº”ç”¨æ˜ å°„åŠŸèƒ½ã€‚ ç±»ä¼¼äºJavaçš„ <code>CompletionStage.thenApply()</code>ã€‚ ç”¨äºå°†ä¸€ä¸ªæ‰¿è¯ºçš„ç»“æœæ˜ å°„åˆ°å…¶ä»–çš„å€¼ã€‚</li><li><code>whenResult(ConsumerEx&lt;T&gt;)</code> - è®¢é˜…ç»™å®šçš„æ¶ˆè´¹è€…ï¼Œåœ¨åŸå§‹PromiseæˆåŠŸå®Œæˆåæ‰§è¡Œã€‚ ç±»ä¼¼äºJavaçš„ <code>CompletionStage.thenAccept()</code>ã€‚</li></ul><p>æ­¤å¤–ï¼Œä¸ºäº†å¤„ç†é”™è¯¯ï¼Œè¿˜æä¾›äº†ä»¥ä¸‹æ–¹æ³•ã€‚</p><ul><li><code>
then(BiFunctionEx  ) - è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œè¯¥Promiseæ˜¯é€šè¿‡å°†åŸå§‹æ‰¿è¯ºçš„ä¸€ä¸ªç»“æœå’Œä¸€ä¸ªå¼‚å¸¸æ˜ å°„åˆ°å…¶ä»–æ‰¿è¯ºè€Œå¾—åˆ°çš„ã€‚&lt;T, Exception, Promise&lt;U&gt;&gt;</code> å¦‚æœæœ€åˆçš„æ‰¿è¯ºè¢«ä¾‹å¤–åœ°å®Œæˆï¼Œä¼ é€’ç»™æ˜ å°„biå‡½æ•°çš„å¼‚å¸¸è¢«ä¿è¯ä¸ºéç©ºã€‚ æ¥å—2ä¸ªå‚æ•°ï¼šä¸€ä¸ªåŸå§‹æ‰¿è¯ºçš„ç»“æœå’Œä¸€ä¸ªä»£è¡¨å¤±è´¥æ‰¿è¯ºçš„å¼‚å¸¸ã€‚</li><li><code>map(BiFunctionEx&lt;T, Exception, U&gt;)</code> - è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œè¯¥Promiseæ˜¯é€šè¿‡å°†åŸå§‹promiseçš„ä¸€ä¸ªç»“æœå’Œä¸€ä¸ªå¼‚å¸¸æ˜ å°„åˆ°å…¶ä»–å€¼è€Œå¾—åˆ°çš„ ã€‚ å¦‚æœè¿™ä¸ªæ‰¿è¯ºä¾‹å¤–åœ°å®Œæˆäº†ï¼Œé‚£ä¹ˆä¼ é€’ç»™æ˜ å°„biå‡½æ•°çš„å¼‚å¸¸å°±ä¼šè¢«ä¿è¯ä¸ºéç©ºã€‚ æ¥å—2ä¸ªå‚æ•°ï¼šä¸€ä¸ªåŸå§‹æ‰¿è¯ºçš„ç»“æœå’Œä¸€ä¸ªä»£è¡¨å¤±è´¥æ‰¿è¯ºçš„å¼‚å¸¸ã€‚</li><li><code>whenException(ConsumerEx&lt;Exception&gt;)</code> - è®¢é˜…ç»™å®šæ¶ˆè´¹è€…çš„expetionï¼Œåœ¨åŸå§‹Promiseå®Œæˆåä¾‹å¤–åœ°æ‰§è¡Œã€‚</li><li><code>whenException(RunnableEx)</code> - è®¢é˜…ç»™å®šçš„Runnableï¼Œåœ¨åŸå§‹Promiseå®Œæˆåä¾‹å¤–åœ°æ‰§è¡Œã€‚</li><li><code>whenComplete(BiConsumerEx&lt;T, Exception&gt;)</code> - è®¢é˜…ç»™å®šçš„ç”Ÿç‰©æ¶ˆè´¹è€…ï¼Œä»¥ä¾¿åœ¨åŸå§‹Promiseå®Œæˆåæ‰§è¡Œ ï¼ˆæ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯ä¾‹å¤–ï¼‰ã€‚ æ¥å—2ä¸ªå‚æ•°ï¼šä¸€ä¸ªåŸå§‹æ‰¿è¯ºçš„ç»“æœå’Œä¸€ä¸ªä»£è¡¨å¤±è´¥æ‰¿è¯ºçš„å¼‚å¸¸ã€‚</li><li><code>whenComplete(RunnableEx)</code> - è®¢é˜…ç»™å®šçš„runnableï¼Œä»¥ä¾¿åœ¨åŸå§‹çš„Promiseå®Œæˆåæ‰§è¡Œ ï¼ˆæ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯ä¾‹å¤–ï¼‰ã€‚</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>æ¯ä¸ªæ‰¿è¯ºé“¾æ–¹æ³•éƒ½éœ€è¦ä¸€ä¸ª&#x27;Ex&#x27;å‡½æ•°ä½œä¸ºå‚æ•°ã€‚ è¿™äº›æ˜¯åŠŸèƒ½æ¥å£ï¼Œç±»ä¼¼äº <code>java.util.function</code> åŒ…ä¸­çš„å¯¹åº”æ¥å£ã€‚ ä¸»è¦åŒºåˆ«åœ¨äºï¼Œæ¯ä¸ª&#x27;Ex&#x27;å‡½æ•°éƒ½å¯èƒ½æŠ›å‡ºä¸€ä¸ª <code>Exception</code>ã€‚</p><p>å¦‚æœä¸€ä¸ª <code>Ex</code> å‡½æ•°æŠ›å‡ºä¸€ä¸ªè¢«æ£€æŸ¥çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„æ‰¿è¯ºä¹Ÿä¼šè¢«ä¾‹å¤–åœ°å®Œæˆã€‚ å¦‚æœä¸€ä¸ªæœªæ£€æŸ¥çš„å¼‚å¸¸è¢«æŠ›å‡º ï¼Œè€Œä¸æ˜¯è¢«æŠ›å‡ºï¼Œä¸€ä¸ªæ‰¿è¯ºå°†ä¸ä¼šè¢«å®Œæˆï¼Œæœªæ£€æŸ¥çš„å¼‚å¸¸å°†è¢«é‡æ–°æŠ›å‡ºã€‚</p></div></div><p>å¦‚æœæœ‰å¤šä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç®€å•åœ°å°†æ–¹æ³•é“¾ ï¼Œä»¥åˆ›å»ºä¸€ä¸ªåºåˆ—ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">doSomeProcess()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .whenResult(result -&gt; System.out.printf(&quot;Result of some process is &#x27;%s&#x27;%n&quot;, result))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .whenException(e -&gt; System.out.printf(&quot;Exception after some process is &#x27;%s&#x27;%n&quot;, e.getMessage()))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map(s -&gt; s.toLowerCase())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map(result -&gt; String.format(&quot;The mapped result is &#x27;%s&#x27;&quot;, result), e -&gt; e.getMessage())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .whenResult(s -&gt; System.out.println(s));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/promise/src/main/java/PromiseChainExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="åˆå¹¶æ‰¿è¯º">åˆå¹¶æ‰¿è¯º<a aria-hidden="true" class="hash-link" href="#åˆå¹¶æ‰¿è¯º" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰§è¡Œå‡ ä¸ª <code>Promise</code>ï¼Œå¹¶å°†å…¶ç»“æœç»“åˆèµ·æ¥ã€‚ ä¸ºæ­¤ï¼Œ ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹é™æ€æ–¹æ³•ï¼Œä» <a href="https://github.com/activej/activej/blob/v5.0/core-promise/src/main/java/io/activej/promise/Promises.java" target="_blank">æ‰¿è¯º</a> ç±»ã€‚</p><ul><li><code>combine()</code> - è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> ï¼Œå½“ä¸¤ä¸ª <code>Promise</code>séƒ½å®Œæˆåï¼Œä»¥ä¸¤ä¸ªç»“æœä¸ºå‚æ•°æ‰§è¡Œã€‚</li><li><code>all()</code> - è¿”å›ä¸€ä¸ª <code>Promise</code> ï¼Œå½“æ‰€æœ‰æä¾›çš„æ‰¿è¯ºéƒ½å®Œæˆæ—¶ï¼Œå°±å®Œæˆäº†ã€‚</li><li><code>any()</code> - è¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„ <code>è¯ºè¨€ä¹‹ä¸€</code>ã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; firstNumber = Promise.of(10);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; secondNumber = Promises.delay(2000, 100);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; result = firstNumber.combine(secondNumber, Integer::sum);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">result.whenResult(res -&gt; System.out.println(&quot;The first result is &quot; + res));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><ul><li><code>delay()</code> - å»¶è¿Ÿå®Œæˆæ‰€æä¾›çš„ <code>Promise</code> ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæ—¶é—´æ®µã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;String&gt; strPromise = Promises.delay(&quot;result&quot;, Duration.seconds(10))</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="ä¼˜åŒ–åŠŸèƒ½">ä¼˜åŒ–åŠŸèƒ½<a aria-hidden="true" class="hash-link" href="#ä¼˜åŒ–åŠŸèƒ½" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>ActiveJ <code>Promise</code> åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¿›è¡Œäº†GCä¼˜åŒ–ã€‚</p><ul><li>ä¸€ä¸ªå…¸å‹çš„ <code>Promise</code> çš„å†…éƒ¨è¡¨ç¤ºç”±1-2ä¸ªå¯¹è±¡ç»„æˆï¼Œ é‡Œé¢çš„å­—æ®µæœ€å°‘ã€‚</li><li>åœ¨ <code>Promise</code> ï¼Œå®ƒå°†ç»“æœä¼ é€’ç»™å®ƒçš„è®¢é˜…è€…ï¼Œç„¶åä¸¢å¼ƒç»“æœã€‚</li></ul><p>ä¸ºäº†ä¼˜åŒ– <code>Promise</code>sï¼Œæœ‰å‡ ä¸ª <code>Promise</code> æ¥å£çš„å®ç°ã€‚</p><div class="mermaid">
graph TD
Promise --&gt; AbstractPromise
Promise --&gt; CompleteExceptionallyPromise
Promise --&gt; CompletePromise
AbstractPromise --&gt; NextPromise
AbstractPromise --&gt; SetablePromise
CompletePromise --&gt; CompleteResultPromise
CompletePromise --&gt; CompleteNullPromise
</div><ul><li><code>Promise</code> - æ ¹æ¥å£ï¼Œè¡¨ç¤º <em>æ‰¿è¯º</em> è¡Œä¸ºã€‚</li><li><code>SettablePromise</code> - å¯ä½œä¸º <code>Promise</code>sé“¾çš„æ ¹ã€‚ å…è®¸åœ¨ <code>Promise</code>sä¸­åŒ…è£¹æ“ä½œï¼Œ ï¼Œç”šè‡³å¯ä»¥åœ¨å®é™…å®Œæˆä¹‹å‰æ‰‹åŠ¨å®Œæˆã€‚</li><li><code>AbstractPromise</code>, <code>NextPromise</code> - å¸®åŠ©ç±»ï¼Œç”¨äºåˆ›å»ºæ— çŠ¶æ€ <em>Promises</em>çš„é“¾ã€‚ ä½ å¯ä»¥æŠŠ ï¼Œè¿™äº›é“¾å°±åƒç®¡é“ä¸€æ ·ï¼ŒæŠŠå€¼ä¼ è¿‡å»ï¼Œä½†ä¸å­˜å‚¨ã€‚</li><li><code>CompletePromise</code> - ä¸€ä¸ªæŠ½è±¡çš„ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªæˆåŠŸå®Œæˆçš„ <code>Promise</code>ã€‚</li><li><code>CompleteExceptionallyPromise</code>, <code>CompleteResultPromise</code>, <code>CompleteNullPromise</code> - å¸®åŠ©ç±»ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="åŸºå‡†">åŸºå‡†<a aria-hidden="true" class="hash-link" href="#åŸºå‡†" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><p>æˆ‘ä»¬å°† <strong>ActiveJ Promise</strong> ä¸ <strong>Java CompletableFuture</strong> åœ¨ä¸åŒçš„åœºæ™¯ä¸­è¿›è¡Œäº†æ¯”è¾ƒã€‚</p><ol><li><strong>ActiveJ Promise</strong>/<strong>Java CompletableFuture</strong> ç”¨ä¸€ä¸ªæ‰¿è¯º/æœªæ¥æ‰§è¡Œæ“ä½œã€‚</li><li><strong>ActiveJ Promise</strong>/<strong>Java CompletableFuture</strong> ç»“åˆäº†å‡ ä¸ªæ‰¿è¯º/æœŸè´§ã€‚</li></ol><p>æˆ‘ä»¬ä½¿ç”¨JMHä½œä¸ºåŸºå‡†å·¥å…·ï¼Œåœ¨ <em>AverageTime</em> æ¨¡å¼ä¸‹è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚ æ‰€æœ‰çš„æµ‹é‡éƒ½æ˜¯ä»¥çº³ç§’ä¸ºå•ä½ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">ActiveJ Promise oneCallMeasure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Cnt: 10; Score: 12.952; Error: Â± 0.693; Units: ns/op;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ActiveJ Promise combineMeasure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Cnt: 10; Score: 34.112; Error: Â± 1.869; å•ä½: ns/op;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Java CompletableFuture oneCallMeasure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Cnt: 10; Score: 85.151; Error: Â± 1.781; å•ä½: ns/op;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Java CompletableFuture combineMeasure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Cnt: 10; Score: 153.645; Error: Â± 4.491; å•ä½: ns/op;</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>ä½ å¯ä»¥åœ¨ä»¥ä¸‹ç½‘ç«™æ‰¾åˆ°åŸºå‡†æ¥æº <a href="https://github.com/activej/activej/blob/v5.0/benchmarks/promise/src/main/java/io/activej/promise" target="_blank"><strong>GitHub</strong></a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="å®ä¾‹">å®ä¾‹<a aria-hidden="true" class="hash-link" href="#å®ä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h2><ul><li><a href="#promisechainexample">æ‰¿è¯ºé“¾å®ä¾‹</a></li><li><a href="#promiseadvancedexample">è¯ºè¨€é«˜çº§ç¤ºä¾‹</a></li><li><a href="#promisesexamples">æ‰¿è¯ºå®ä¾‹</a></li><li><a href="#asyncfileserviceexample">å¼‚æ­¥æ–‡ä»¶å®ä¾‹</a></li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>è¦è¿è¡Œä¾‹å­ï¼Œä½ éœ€è¦ä»GitHubå…‹éš†ActiveJ</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W shell"><pre tabindex="0" class="prism-code language-shell codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/activej/activej</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>å¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªMavené¡¹ç›®å¯¼å…¥ã€‚ æŸ¥çœ‹æ ‡ç­¾ <strong>v5.0</strong>ã€‚ åœ¨è¿è¡Œè¿™äº›ä¾‹å­ä¹‹å‰ï¼Œå…ˆå»ºç«‹é¡¹ç›®ã€‚ è¿™äº›ä¾‹å­ä½äº <code>activej/examples/core/promiseã€‚</code></p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ‰¿è¯ºé“¾ç¤ºä¾‹">æ‰¿è¯ºé“¾ç¤ºä¾‹<a aria-hidden="true" class="hash-link" href="#æ‰¿è¯ºé“¾ç¤ºä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>ä½ å¯ä»¥åˆ›å»º <code>Promise</code>çš„é“¾ï¼Œç”šè‡³åœ¨å®ƒä»¬å®Œæˆä¹‹å‰ï¼Œä½ è¿˜ä¸çŸ¥é“å®ƒä»¬æ˜¯æˆåŠŸå®Œæˆ è¿˜æ˜¯å‡ºç°å¼‚å¸¸ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª <em>doSomeProcess</em> ï¼Œå®ƒè¿”å›ä¸€ä¸ª <code>Promise</code> ï¼Œæœ‰ç›¸ç­‰çš„ æœºä¼šæˆåŠŸå®Œæˆæˆ–å‡ºç°å¼‚å¸¸ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé“¾ï¼Œå®ƒå°†å¤„ç†è¿™ä¸¤ç§æƒ…å†µã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@SuppressWarnings(&quot;Convert2MethodRef&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PromiseChainExample {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  private static final Eventloop eventloop = Eventloop.create().withCurrentThread();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public static void main(String[] args) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //[START REGION_1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    doSomeProcess()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .whenResult(result -&gt; System.out.printf(&quot;Result of some process is &#x27;%s&#x27;%n&quot;, result))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .whenException(e -&gt; System.out.printf(&quot;Exception after some process is &#x27;%s&#x27;%n&quot;, e.getMessage()))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map(s -&gt; s.toLowerCase())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map(result -&gt; String.format(&quot;The mapped result is &#x27;%s&#x27;&quot;, result), e -&gt; e.getMessage())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .whenResult(s -&gt; System.out.println(s));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //[END REGION_1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Promise.complete()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .then(PromiseChainExample::loadData)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .whenResult(result -&gt; System.out.printf(&quot;Loaded data is &#x27;%s&#x27;%n&quot;, result));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventloop.run();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  private static Promise&lt;String&gt; loadData() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Promise.of(&quot;Hello World&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public static Promise&lt;String&gt; doSomeProcess() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Promises.delay(1000, Math.random() &gt; 0.5 ?</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Promise.of(&quot;Hello World&quot;) :</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Promise.ofException(new RuntimeException(&quot;Something went wrong&quot;)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>å¦‚æœä½ è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œä½ ä¼šæ”¶åˆ°è¿™æ ·çš„è¾“å‡ºï¼ˆå¦‚æœ <em>doSomeProcess</em> æˆåŠŸå®Œæˆï¼‰ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">åŠ è½½çš„æ•°æ®æ˜¯&#x27;Hello World&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æŸä¸ªè¿›ç¨‹çš„ç»“æœæ˜¯&#x27;Hello World&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æ˜ å°„çš„ç»“æœæ˜¯&#x27;Hello World&#x27; ã€‚</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>æˆ–è€…è¿™æ ·ï¼Œå¦‚æœå®ƒä»¥å¼‚å¸¸ç»“æŸã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">åŠ è½½çš„æ•°æ®æ˜¯&#x27;Hello World&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æŸä¸ªè¿‡ç¨‹åå‡ºç°çš„å¼‚å¸¸æ˜¯&#x27;å‡ºé”™äº†&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">å‡ºé”™äº†</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è¯·æ³¨æ„ï¼Œç¬¬ä¸€è¡Œæ˜¯</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">è½½å…¥çš„æ•°æ®æ˜¯ &quot;Hello World&quot;ã€‚</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è¿™æ˜¯ç”±äºæˆ‘ä»¬åœ¨ <em>doSomeProcess</em>ä¸­è®¾ç½®äº†1ç§’çš„å»¶è¿Ÿã€‚</p><p><strong><a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/promise/src/main/java/PromiseChainExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ‰¿è¯ºé«˜çº§ç¤ºä¾‹">æ‰¿è¯ºé«˜çº§ç¤ºä¾‹<a aria-hidden="true" class="hash-link" href="#æ‰¿è¯ºé«˜çº§ç¤ºä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>ä½ å¯ä»¥å°†å‡ ä¸ª <code>Promise</code>sï¼Œä¾‹å¦‚ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; firstNumber = Promise.of(10);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; secondNumber = Promises.delay(2000, 100);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; result = firstNumber.combine(secondNumber, Integer::sum);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">result.whenResult(res -&gt; System.out.println(&quot;The first result is &quot; + res));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>ä¹Ÿæœ‰å‡ ç§æ–¹æ³•å¯ä»¥å»¶è¿Ÿ <code>æ‰¿è¯º</code>ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">int someValue = 1000;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">int delay = 1000;     // in milliseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">int interval = 2000;  // also in milliseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; intervalPromise = Promises.interval(interval, Promise.of(someValue));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; schedulePromise = Promises.schedule(someValue * 2, Instant.now());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; delayPromise = Promises.delay(delay, someValue);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Promise&lt;Integer&gt; result = intervalPromise</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .combine(schedulePromise, (first, second) -&gt; first - second)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .combine(delayPromise, Integer::sum);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">result.whenResult(res -&gt; System.out.println(&quot;The second result is &quot; + res));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/promise/src/main/java/PromiseAdvancedExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ‰¿è¯ºå®ä¾‹">æ‰¿è¯ºå®ä¾‹<a aria-hidden="true" class="hash-link" href="#æ‰¿è¯ºå®ä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p><a href="#"><a href="https://github.com/activej/activej/blob/v5.0/core-promise/src/main/java/io/activej/promise/Promises.java" target="_blank"><code>Promises</code></a></a> æ˜¯ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤šä¸ª <code>Promise</code>ã€‚ è¿™ä¸ªä¾‹å­å°†å±•ç¤ºä¸‰ä¸ªç”¨ä¾‹ã€‚</p><ul><li>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Promises</code> <code>loop</code>ï¼Œå®ƒç±»ä¼¼äºJava <code>for</code> loopï¼Œä½†å…·æœ‰å¼‚æ­¥åŠŸèƒ½ï¼Œ ï¼Œå®ƒç”± <code>Promise</code>æä¾›ã€‚</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promises.loop(0,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    i -&gt; i &lt; 5,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    i -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.out.println(&quot;This is iteration #&quot; + i);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return Promise.of(i + 1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è¾“å‡ºæ˜¯ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">å¸¦æ¡ä»¶çš„å¾ªç¯ï¼š</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯è¿­ä»£#1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯è¿­ä»£#2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯è¿­ä»£#3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯è¿­ä»£#4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯è¿­ä»£#5</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>2.å¦ä¸€ä¸ªä¾‹å­ä½¿ç”¨ <code>Promises</code> <code>toList</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>Promise</code>sç»“æœçš„åˆ—è¡¨ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promises.toList(Promise.of(1), Promise.of(2), Promise.of(3), Promise.of(4), Promise.of(5), Promise.of(6))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .whenResult(list -&gt; System.out.println(&quot;Size of collected list: &quot; + list.size() + &quot;\nList: &quot; + list));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è¾“å‡ºæ˜¯ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">å°†**æ‰¿è¯º**ç»„æ”¶é›†åˆ°**æ‰¿è¯º**çš„åˆ—è¡¨ä¸­ï¼Œç»“æœï¼š</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æ”¶é›†çš„åˆ—è¡¨å¤§å°ã€‚6</span></span><span class="token-line" style="color:#393A34"><span class="token plain">åˆ—è¡¨ã€‚[1, 2, 3, 4, 5, 6]</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>3.åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ <strong>Promises</strong> <em>toArray</em> æ–¹æ³•è¢«åˆ©ç”¨ï¼Œå®ƒå°† <em>promises</em> å‡å°‘ä¸ºæ‰€æä¾›çš„æ•°æ®ç±»å‹çš„æ•°ç»„ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ <em>Integers</em>ï¼‰ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Promises.toArray(Integer.class, Promise.of(1), Promise.of(2), Promise.of(3), Promise.of(4), Promise.of(5), Promise.of(6))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .whenResult(array -&gt; System.out.println(&quot;Size of collected array: &quot; + array.length + &quot;\nArray: &quot; + Arrays.toString(array)));</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>è€Œæœ€ç»ˆçš„è¾“å‡ºæ˜¯ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">å°†**æ‰¿è¯º**ç»„æ”¶é›†åˆ°**æ‰¿è¯º**çš„æ•°ç»„ä¸­ï¼Œç»“æœï¼š</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æ”¶é›†çš„æ•°ç»„å¤§å°ã€‚6</span></span><span class="token-line" style="color:#393A34"><span class="token plain">é˜µåˆ—ã€‚[1, 2, 3, 4, 5, 6]</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/promise/src/main/java/PromisesExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="å¼‚æ­¥æ–‡ä»¶æœåŠ¡ç¤ºä¾‹">å¼‚æ­¥æ–‡ä»¶æœåŠ¡ç¤ºä¾‹<a aria-hidden="true" class="hash-link" href="#å¼‚æ­¥æ–‡ä»¶æœåŠ¡ç¤ºä¾‹" title="ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜">â€‹</a></h3><p>å¦å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Promises</code> ï¼Œä¸æ–‡ä»¶ç³»ç»Ÿä¸€èµ·å·¥ä½œã€‚ å½“ä½ è¿è¡Œè¿™ä¸ªä¾‹å­æ—¶ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">private static @NotNull Promise&lt;Void&gt; writeToFile() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    FileChannel channel = FileChannel.open(PATH, setOf(WRITE, APPEND));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] message1 = &quot;Hello\n&quot;.getBytes();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] message2 = &quot;This is test file\n&quot;.getBytes();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] message3 = &quot;This is the 3rd line in file&quot;.getBytes();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fileService.write(channel, 0, message1, 0, message1.length)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .then(() -&gt; fileService.write(channel, 0, message2, 0, message2.length))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .then(() -&gt; fileService.write(channel, 0, message3, 0, message3.length))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .toVoid();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  } catch (IOException e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Promise.ofException(e);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">private static @NotNull Promise&lt;ByteBuf&gt; readFromFile() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  byte[] array = new byte[1024];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  FileChannel channel;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    channel = FileChannel.open(PATH, setOf(READ));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  } catch (IOException e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Promise.ofException(e);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return fileService.read(channel, 0, array, 0, array.length)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(bytesRead -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ByteBuf buf = ByteBuf.wrap(array, 0, bytesRead);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(buf.getString(UTF_8));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return buf;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p>......ä½ ä¼šæ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œå®ƒä»£è¡¨äº†æ‰€åˆ›å»ºçš„æ–‡ä»¶çš„å†…å®¹ã€‚</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">ä½ å¥½</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯æµ‹è¯•æ–‡ä»¶</span></span><span class="token-line" style="color:#393A34"><span class="token plain">è¿™æ˜¯æ–‡ä»¶ä¸­çš„ç¬¬ä¸‰è¡Œ</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_2e3i clean-btn">æ‹·è´</button></div></div><p><strong><a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/promise/src/main/java/AsyncFileServiceExample.java" target="_blank">åœ¨GitHubä¸Šçœ‹åˆ°å®Œæ•´çš„ä¾‹å­</a></strong></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£é¡µé¢å¯¼èˆª"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/async-io/eventloop"><div class="pagination-nav__sublabel">ä¸Šä¸€ç¯‡</div><div class="pagination-nav__label">Â« <!-- -->äº‹ä»¶é“¾æ¥</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/async-io/csp"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">CSP<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ¦‚è¿°" class="table-of-contents__link toc-highlight">æ¦‚è¿°</a></li><li><a href="#ç‰¹ç‚¹" class="table-of-contents__link toc-highlight">ç‰¹ç‚¹</a><ul><li><a href="#åˆ›é€ è¯ºè¨€" class="table-of-contents__link toc-highlight">åˆ›é€ è¯ºè¨€</a></li><li><a href="#é“¾å¼æ‰¿è¯º" class="table-of-contents__link toc-highlight">é“¾å¼æ‰¿è¯º</a></li><li><a href="#åˆå¹¶æ‰¿è¯º" class="table-of-contents__link toc-highlight">åˆå¹¶æ‰¿è¯º</a></li></ul></li><li><a href="#ä¼˜åŒ–åŠŸèƒ½" class="table-of-contents__link toc-highlight">ä¼˜åŒ–åŠŸèƒ½</a></li><li><a href="#åŸºå‡†" class="table-of-contents__link toc-highlight">åŸºå‡†</a></li><li><a href="#å®ä¾‹" class="table-of-contents__link toc-highlight">å®ä¾‹</a><ul><li><a href="#æ‰¿è¯ºé“¾ç¤ºä¾‹" class="table-of-contents__link toc-highlight">æ‰¿è¯ºé“¾ç¤ºä¾‹</a></li><li><a href="#æ‰¿è¯ºé«˜çº§ç¤ºä¾‹" class="table-of-contents__link toc-highlight">æ‰¿è¯ºé«˜çº§ç¤ºä¾‹</a></li><li><a href="#æ‰¿è¯ºå®ä¾‹" class="table-of-contents__link toc-highlight">æ‰¿è¯ºå®ä¾‹</a></li><li><a href="#å¼‚æ­¥æ–‡ä»¶æœåŠ¡ç¤ºä¾‹" class="table-of-contents__link toc-highlight">å¼‚æ­¥æ–‡ä»¶æœåŠ¡ç¤ºä¾‹</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021å¹´ ActiveJ LLC.ä¿ç•™æ‰€æœ‰æƒåˆ©</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.e188156b.js"></script>
<script src="/zh/assets/js/main.5fe716eb.js"></script>
</body>
</html>